(function(root,factory){'use strict';if(typeof define==='function'&&define.amd){define([],factory);}else if(typeof exports==='object'){module.exports=factory();}else{root.autosize=factory();}}(this,function(){function main(ta){if(!ta||!ta.nodeName||ta.nodeName!=='TEXTAREA'||ta.hasAttribute('data-autosize-on')){return;}
var maxHeight;var heightOffset;function init(){var style=window.getComputedStyle(ta,null);if(style.resize==='vertical'){ta.style.resize='none';}else if(style.resize==='both'){ta.style.resize='horizontal';}
ta.style.wordWrap='break-word';var width=ta.style.width;ta.style.width='0px';ta.offsetWidth;ta.style.width=width;maxHeight=style.maxHeight!=='none'?parseFloat(style.maxHeight):false;if(style.boxSizing==='content-box'){heightOffset=-(parseFloat(style.paddingTop)+parseFloat(style.paddingBottom));}else{heightOffset=parseFloat(style.borderTopWidth)+parseFloat(style.borderBottomWidth);}
adjust();}
function adjust(){var startHeight=ta.style.height;var htmlTop=document.documentElement.scrollTop;var bodyTop=document.body.scrollTop;ta.style.height='auto';var endHeight=ta.scrollHeight+heightOffset;if(maxHeight!==false&&maxHeight<endHeight){endHeight=maxHeight;if(ta.style.overflowY!=='scroll'){ta.style.overflowY='scroll';}}else if(ta.style.overflowY!=='hidden'){ta.style.overflowY='hidden';}
ta.style.height=endHeight+'px';document.documentElement.scrollTop=htmlTop;document.body.scrollTop=bodyTop;if(startHeight!==ta.style.height){var evt=document.createEvent('Event');evt.initEvent('autosize.resized',true,false);ta.dispatchEvent(evt);}}
if('onpropertychange'in ta&&'oninput'in ta){ta.addEventListener('keyup',adjust);}
window.addEventListener('resize',adjust);ta.addEventListener('input',adjust);ta.addEventListener('autosize.update',adjust);ta.addEventListener('autosize.destroy',function(style){window.removeEventListener('resize',adjust);ta.removeEventListener('input',adjust);ta.removeEventListener('keyup',adjust);ta.removeEventListener('autosize.destroy');Object.keys(style).forEach(function(key){ta.style[key]=style[key];});ta.removeAttribute('data-autosize-on');}.bind(ta,{height:ta.style.height,overflow:ta.style.overflow,overflowY:ta.style.overflowY,wordWrap:ta.style.wordWrap,resize:ta.style.resize}));ta.setAttribute('data-autosize-on',true);ta.style.overflow='hidden';ta.style.overflowY='hidden';init();}
if(typeof window.getComputedStyle!=='function'){return function(elements){return elements;};}else{return function(elements){if(elements&&elements.length){Array.prototype.forEach.call(elements,main);}else if(elements&&elements.nodeName){main(elements);}
return elements;};}}));var login={};var uri='http://www.alldone.io/api/';var homeuri='http://www.alldone.io/';var update_notify_count=0;var runtime='none';function alldone_login(user,pswd){var obj={'request':'login','user':user,'pswd':pswd};$('#updating').show();var jqxhr=$.post(uri,obj).done(function(data){app_login_complete(jQuery.parseJSON(data));$('#updating').hide();}).fail(function(xhr,textStatus,errorThrown){$('#updating').hide();alert(xhr.responseText);alert(textStatus);});}
function alldone_grab(slashid){var obj={'request':'grab','session':login.session,'uid':login.uid,'list':slashid};$('#updating').show();var jqxhr=$.post(uri,obj).done(function(data){app_grab_complete(jQuery.parseJSON(data));$('#updating').hide();}).fail(function(){$('#updating').hide();alert("error");});}
function alldone_update_notify(){if(!public_use){update_notify_count++;var check=update_notify_count;$('#updating').show();setTimeout(function(){if(update_notify_count===check){alldone_update();}},1000);}}
function alldone_update(){update_notify_count=0;var prep_data={todo_list:todo_list,colourscheme:user_options.colourscheme,mode:user_options.mode};var obj={'request':'update','session':login.session,'uid':login.uid,'owner':todo_owner,'uri':todo_title,'data':JSON.stringify(prep_data)};console.log(prep_data);var jqxhr=$.post(uri,obj).done(function(data){$('#updating').hide();var json=jQuery.parseJSON(data);if(json.result===0){if(json.error==='login'){if(runtime==='app'){login={};app_boot();}else{alert('please login again!');}}}}).fail(function(){dialog({type:'error',title:'Error saving',text:'Error saving data.'});$('#updating').hide();});}
function load_session(){if(localStorage.getItem("alldone_session")===null){login={};}else{login=jQuery.parseJSON(localStorage.alldone_session);}}
function update_session(){localStorage.alldone_session=JSON.stringify(login);}
var recursive_hit=false;function todo_from_bc(bc){recursive_fetched={};recursive_magic(bc,0,'fetch',{},todo_list);return recursive_fetched;}
function save_to_bc(bc,todo){modify_todo(todo,bc);}
function add_todo(todo,bc){todo_list=recursive_magic(bc,0,'add',todo,todo_list);redraw(open_breadcrumbs);}
function modify_todo(todo,bc){todo_list=recursive_magic(bc,0,'mod',todo,todo_list);redraw(open_breadcrumbs);}
function recurse_todo(bc,changes){todo_list=recursive_magic(bc,0,'recurse',changes,todo_list);redraw(open_breadcrumbs);}
function fetch_todo(breadcrumbs){recursive_fetched={};recursive_magic(breadcrumbs,0,'fetch',{},todo_list);return recursive_fetched;}
function recursive_magic(breadcrumbs,step,action,item,todo_list_mod){if(step===0){recursive_hit=false;}
if(recursive_hit){return todo_list_mod;}
var action_mod=false;if((action==='mod')||(action==='fetch')||(action==='recurse')){action_mod=true;}
if((step===(breadcrumbs.length))||(breadcrumbs.length===0)){if(action==='add'){todo_list_mod.push(clone_item(item));recursive_hit=true;return todo_list_mod;}
if(action==='delete'){todo_list_mod[item.target].deleting=true;todo_list_mod[item.target].title=todo_list_mod[item.target].title+' DELETING';recursive_hit=true;return todo_list_mod;}}else{if((todo_list_mod[breadcrumbs[step]])&&((step+1)===(breadcrumbs.length))&&(action_mod)){if(action==='mod'){todo_list_mod[breadcrumbs[step]]=mod_item(todo_list_mod[breadcrumbs[step]],item);recursive_hit=true;return todo_list_mod;}
if(action==='fetch'){recursive_fetched=clone_item(todo_list_mod[breadcrumbs[step]]);recursive_hit=true;return todo_list_mod;}
if(action==='recurse'){if(todo_list_mod[breadcrumbs[step]].children){todo_list_mod[breadcrumbs[step]].children=recursive_child_update(todo_list_mod[breadcrumbs[step]].children,item);}}}else{if((todo_list_mod[breadcrumbs[step]])&&(todo_list_mod[breadcrumbs[step]].children)){todo_list_mod[breadcrumbs[step]].children=recursive_magic(breadcrumbs,(step+1),action,item,todo_list_mod[breadcrumbs[step]].children);}}}
return todo_list_mod;}
function recursive_tidy(todo_list_mod){$.each(todo_list_mod,function(key,value){if(value){if(value.deleting){todo_list_mod.splice(key,1);todo_list_mod=recursive_tidy(todo_list_mod);}else{if(value.children){this.children=recursive_tidy(this.children);}}}});return todo_list_mod;}
function recursive_child_update(todo_list_mod,changes){$.each(todo_list_mod,function(key,value){if(value){if(changes.done_set){this.done=changes.done;}
if(value.children){this.children=recursive_child_update(this.children,changes);}}});return todo_list_mod;}
function clone_item(i){var io=$.extend(true,{},i);return io;}
function mod_item(a,b){var c=clone_item(a);if(b.editingUpdate){c.editing=b.editing;}else{c.title=b.title;c.done=b.done;c.details=b.details;c.tags=b.tags;c.magic=b.magic;}
return c;}
function breadcrumbs_from_index(steps,index){var bc=[];for(i=0;i<steps;i++){if((open_breadcrumbs[i])||(open_breadcrumbs[i]===0)){bc.push(open_breadcrumbs[i]);}}
if(isNumber(index)){bc.push(parseInt(index));}
return bc;}
function breadcrumb_explosion(t){var split=t.split("-");var r=[];for(i=0;i<split.length;i++){if(isNumber(split[i])){r.push(parseInt(split[i]));}}
return r;}
function breadcrumb_removelast(bc){var bc_2=bc.slice();bc_2.splice(-1,1);return bc_2;}
function breadcrumb_returnlast(bc){var bc_2=bc.slice();return bc_2[bc_2.length-1];}
function sorted(e,event,ui){var newOrder=$(e).sortable('toArray');var target=ui.item.context;var target=$(target).closest('li');var targetid=$(target).attr("id");if(!targetid){console.log('Sorting error. Did you drag a parent into child? Miss? Eek! (targetid: '+targetid+')');console.log(target);redraw(open_breadcrumbs);return 0;}
var bc_dragged=breadcrumb_explosion($(target).attr("breadcrumbs"));var bc_dragged_parent=breadcrumb_removelast(bc_dragged);var insert_bc=breadcrumb_explosion($(e).attr("breadcrumbs"));recursive_fetched={};recursive_magic(bc_dragged,0,'fetch',{},todo_list);var dragged_item=recursive_fetched;if(!event.shiftKey){var bc_del_target=breadcrumb_returnlast(bc_dragged);todo_list=recursive_magic(bc_dragged_parent,0,'delete',{target:bc_del_target},todo_list);}
var sort_cache=[];$.each(newOrder,function(i,val){if((val!=="")&&(val!==targetid)){var bc=breadcrumb_explosion($('#'+val).attr("breadcrumbs"));recursive_fetched={};recursive_magic(bc,0,'fetch',{},todo_list);sort_cache[val]=recursive_fetched;if(!recursive_fetched.title){alert('sorting error');return 0;}}});$.each(newOrder,function(i,val){if((val!=="")&&(val!==targetid)){var bc=breadcrumb_explosion($('#'+val).attr("breadcrumbs"));var bc_del_target=breadcrumb_returnlast(bc);bc=breadcrumb_removelast(bc);todo_list=recursive_magic(bc,0,'delete',{target:bc_del_target},todo_list);}});$.each(newOrder,function(i,val){if(val!==""){if(sort_cache[val]){todo_list=recursive_magic(insert_bc,0,'add',sort_cache[val],todo_list);}
if(val===targetid){todo_list=recursive_magic(insert_bc,0,'add',dragged_item,todo_list);}}});todo_list=recursive_tidy(todo_list);open_breadcrumbs=breadcrumb_removelast(insert_bc);redraw(open_breadcrumbs);alldone_update_notify();}var current_hover=0,label_mousedown=false;var blahblahblah=false;function sizeup(){var scale_by=screenmode();if(user_options.mode!=='vertical'){var newWidth=($(window).width()/scale_by);$('ul').outerWidth(newWidth);var count=$('ul').length;$('#wrapper').width(count*newWidth);if($('body').hasClass('vertical')){$('body').removeClass('vertical');}}
if(user_options.mode==='vertical'){var newWidth=($(window).width())-(vert_indent*4);if(!$('body').hasClass('vertical')){$('body').addClass('vertical');$('#wrapper').width('100%');}}
var inputWidth=newWidth-100;$('input.edit, input.new').width(inputWidth-50);$('textarea.edit, textarea.new').width(inputWidth);$('li label').width(inputWidth);}
function screenmode(){if(user_options.fullscreen){return 1;}else{if($('body').width()>1024){return 3;}else{if($('body').width()>640){return 2;}else{return 1;}}}}
function redraw(breadcrumbs){if(!pause_redraw){var working_breadcrumbs=[],html="";$('body').removeClass()
$('body').addClass(user_options.colourscheme);redrawing=breadcrumbs;old_breadcrumbs=open_breadcrumbs;retain_forms(false);retain_scroll(false);if((user_options.mode=='horizontal')||(!user_options.mode)){html+=draw_list(working_breadcrumbs);$.each(breadcrumbs,function(i,val){working_breadcrumbs.push(breadcrumbs[i]);html+=draw_list(working_breadcrumbs);});if((breadcrumbs.length<open_breadcrumbs.length)&&(open_breadcrumbs.length>(screenmode()-1))){open_breadcrumbs=breadcrumbs;updateScroll(false,breadcrumbs.length,html);}else{open_breadcrumbs=breadcrumbs;redraw_finalize(html,true);}}else{open_breadcrumbs=breadcrumbs;html+=draw_list(working_breadcrumbs);redraw_finalize(html,true);}}}
function redraw_finalize(html,scroll){$('#wrapper').empty().append(html);sizeup();set_classes();assign_clicks();retain_forms(true);retain_scroll(true);sort_setup();mobile_update();callback(false,{});if(scroll){updateScroll(true,0,'');}
if(first_load){magic_scan_init();first_load=false;if(runtime=='app'){app_window_update();}}}
function updateScroll(auto,moveto,html){var count=$('ul').length,width=$('ul').outerWidth(),diff=0;var cScroll=$('body').scrollLeft(),cSize=$('#wrapper').width();if(!auto){if(screenmode()===1){count=moveto;}
if(screenmode()===2){count=moveto-1;}
if(screenmode()===3){count=moveto-2;}}else{count=count-1;}
var goScroll=true;if(old_breadcrumbs.length===open_breadcrumbs.length){goScroll=false;}
if(goScroll){$('html, body').animate({scrollLeft:((count)*width)},500,function(){if(!auto){redraw_finalize(html,false);}});}}
function mobile_update(){if((/iPhone|iPod|iPad|Android|BlackBerry/).test(navigator.userAgent)){$("li .edit_button").css('display','block');}else{$("li .edit_button").css('display','');}}
function clear_autosize(e){autosize($('textarea.new, textarea.edit'));}
function checkbox_please(checked){if(checked){return"<i class=\"fa fa-check fa-fw\"></i>";}else{return"<i class=\"fa fa-times fa-fw\"></i>";}}
function assign_clicks(){$('li .expand').unbind("click");$('li .close').unbind("click");$('li textarea.new').unbind("enterKey");$('li textarea.new').unbind("keydown");$('li textarea.edit').unbind("enterKey");$('li textarea.edit').unbind("keydown");$('li label').unbind("keyup");$('li .expand').click(function(){expand($(this).parent());});$('li .contract').click(function(){close($(this).parent());});$('li .close').click(function(){close($(this).parent().parent());});$('li.close_header').click(function(){close($(this).parent());});if(!read_only){$('li textarea.new, li textarea.edit').bind("focus",function(e){autosize(this);});$('li textarea.new').bind("enterKey",function(e){add(this);});$('li textarea.new').keypress(function(e){if(e.keyCode==13)
{$(this).trigger("enterKey");}});$('li textarea.edit').bind("enterKey",function(e){modify_save_open();});$('li textarea.edit').keypress(function(e){if(e.keyCode==13)
{$(this).trigger("enterKey");}});$('li .more').click(function(){details_dialog(this);});$('div.checkbox').not('.disabled').click(function(e){check(this,e);});$('div.sort_toggle').click(function(){sort_toggle();});}
if((user_options.editmode)&&(!read_only)){$('li label').click(function(){modify(this);});}else{$('li label').not('li.open label, li.static').click(function(){expand($(this).parent());});$('li.open label').not('li.static').click(function(){close($(this).parent());});$('li').not('li.open, li.static').click(function(){expand($(this));}).children().click(function(e){return false;});$('li.open').not('li.static').click(function(){close($(this));}).children().click(function(e){return false;});$('.edit_button').click(function(){modify(this);});$('li .count').not('li.open .count').click(function(){expand($(this).parent());});$('li.open .count').click(function(){close($(this).parent());});}
$('div.json_view').click(function(){json_mod_start();});$('div.magic_refresh').click(function(){magic_scan_init();});$('div.settings').click(function(){settings_dialog();});if(runtime=='app'){$('div.mainmenu.app').click(function(){app_lists(true);});}
if(runtime=='app'){$('div.mainmenu.app').click(function(){if(!$('#updating').is(':visible')){app_lists(true);}else{dialog({type:'still_saving'});}});}
if(runtime=='web'){$('div.mainmenu.web').click(function(){if(!$('#updating').is(':visible')){document.location.href=homeuri;}else{dialog({type:'still_saving'});}});}}
function set_classes(){$.each(open_breadcrumbs,function(i,val){$('#item-'+i+'-'+val).addClass('open');});}
function retain_forms(restore){if(!restore){form_history=[];form_count=$('li input.new').length;$('li input.new').each(function(){form_history[$(this).attr("id")]={};form_history[$(this).attr("id")].title=$(this).val();});}
if((restore)&&(form_history)){var lastinput=0;$('li input.new').each(function(){if(form_history[$(this).attr("id")]){var res=form_history[$(this).attr("id")];$(this).val(res.title);lastinput=this;}});if($('li input.new').length===form_count){$(lastinput).val('');}}}
function retain_scroll(restore){if(!restore){scroll_history=[];$('ul.list').each(function(){if($(this).scrollTop()>0){scroll_history[$(this).attr("breadcrumbs")]=$(this).scrollTop();}});}else{$('ul.list').each(function(){var checkBc=$(this).attr("breadcrumbs");if(scroll_history[checkBc]){$(this).scrollTop(scroll_history[checkBc]);}});}}
function context_pop(item,e){var html="<div class=context style=\"top:"+e.pageY+"px; left:"+e.pageX+"px;\">";html+="<div onclick=\"settings();\">Details...</div>";html+="<div onclick=\"settings();\">Delete</div>";html+="<div onclick=\"settings();\">Disable menu</div>";html+="</div>";$('body').append(html);$('body').click(function(){$('.context').remove();});}
function sort_setup(){if(sort_mode){var cw="",cw_count=$("ul.list").length;for(i=0;i<cw_count;i++){var cw="";for(j=0;j<cw_count;j++){if(j!==i){if(cw!==""){cw+=", ";}
cw+="#crumbs-"+j;}}
$("#crumbs-"+i).sortable({"cancel":"li.static","connectWith":cw,"sort":function(event,ui){if(ui.placeholder.index()===0){return false;}},"update":function(event,ui){if(this===ui.item.parent()[0]){sorted(this,event,ui);}}});$("#crumbs-"+i).disableSelection();}}}
function sort_toggle(){if(sort_mode){sort_mode=false;}else{sort_mode=true;dialog({type:'sort_beta'});}
redraw(open_breadcrumbs);}
function dialog(options){var title='',text='',buttons='',bindOverlay=true,bindStandardButtons=true,focusButton='',newclass='';if(options.type==='delete_with_children'){newclass='question';title='<i class=\"fa fa-warning\"></i> This has children. Continue?';text='Deleting this item will delete the child items within.';buttons='<input type=button value=\"Delete\" id=\"dialog_delete\"> <input type=button value=\"Cancel\" id=\"dialog_cancel\">';bindOverlay=false;bindStandardButtons=false;focusButton='dialog_delete';}
if(options.type==='sort_beta'){newclass='question';title='<i class=\"fa fa-sort\"></i> Sorting is a beta function!';text='If you are doing anything drastic, I recommend you back up first. Please be careful';text+=' not to drag any items into their children. Bad things will happen.';buttons='<input type=button value=\"Got it.\" id=\"dialog_okay\">';bindOverlay=true;bindStandardButtons=true;}
if(options.type==='details'){newclass='details';var deets=details_dialog_gen(options.item);title='<i class=\"fa fa-pencil\"></i> Edit';text=deets.html;buttons="<input type=button value=\"Update\" id=\"dialog_update\"> <input type=button value=\"Cancel\" onclick=\"dialog_close();\">";bindStandardButtons=false;}
if(options.type==='settings'){newclass='details';var deets=settings_dialog_gen();title='<i class=\"fa fa-pencil\"></i> List settings';text=deets.html;buttons="<input type=button value=\"Save\" id=\"dialog_update\"> <input type=button value=\"Cancel\" onclick=\"dialog_close();\">";bindStandardButtons=false;}
if(options.type==='login'){newclass='details';var deets=login_dialog();title='<i class=\"fa fa-user\"></i> Login to alldone.io';text=deets.html;buttons="<input type=button value=\"Login\" id=\"dialog_login\"> <input type=button value=\"Sign up\" id=\"dialog_signup\">";bindStandardButtons=false;bindOverlay=false;}
if(options.type==='lists'){newclass='details';var deets=lists_dialog();title='<i class=\"fa fa-question-circle\"></i> Select a list';text=deets.html;buttons="<input type=button value=\"Select\" id=\"dialog_select\"> <input type=button value=\"Create\" id=\"dialog_create\">  <input type=button value=\"Log out\" id=\"dialog_logout\">";bindStandardButtons=false;if(options.allow_close){bindOverlay=true;buttons+=" <input type=button value=\"Cancel\" id=\"dialog_cancel\" onclick=\"dialog_close();\">";}else{bindOverlay=false;}
buttons+="<div style=\"margin-top:5px;\"><input type=\"checkbox\" id=\"alwaysopen\"> <label for=\"alwaysopen\">Always open this list first</label></div>";}
if(options.type==='error'){newclass='question';title='<i class=\"fa fa-frown-o \"></i> '+options.title;text=options.text;buttons='<input type=button value=\"Okay\" id=\"dialog_okay\">';bindOverlay=true;bindStandardButtons=true;}
if(options.type==='still_saving'){newclass='question';title='<i class=\"fa fa-cog fa-spin\"></i> Please wait';text='Still saving changes. Try again in a moment!';buttons='<input type=button value=\"Okay\" id=\"dialog_okay\">';bindOverlay=true;bindStandardButtons=true;}
if(options.type==='magic'){newclass='question';title='<i class=\"fa fa-cog fa-spin\"></i> Performing magic <i class=\"fa fa-magic\"></i>';text='Updating: '+options.subtext;buttons='';bindOverlay=false;bindStandardButtons=false;}
$('#dialog div.title').html(title);$('#dialog div.content').html(text);$('#dialog div.buttons').html(buttons);$("#dialog").addClass(newclass);$('#overlay').show();$('#dialog').show();if(bindOverlay){$('#overlay').click(function(){dialog_close();});}
if(bindStandardButtons){$('#dialog_okay').click(function(){dialog_close();});}
if(focusButton!==''){setTimeout(function(){$('#'+focusButton).focus();},10);}}
function dialog_close(){$("#dialog").removeClass();$('#dialog').hide();$('#overlay').hide();$('#overlay, #dialog_cancel, #dialog_delete, #dialog_okay').unbind("click");}
function hover_pop(e){var bc=breadcrumb_explosion($('#'+e).attr('breadcrumbs'));var todo=todo_from_bc(bc);console.log(todo);}
var details_open_bc=[];function details_dialog(e){dialog({type:'details',item:e});autosize($('#dialog .fieldset textarea'));$('#dialog_update').click(function(){details_dialog_save();});}
function details_dialog_gen(e){var obj={},html='';details_open_bc=breadcrumb_explosion($(e).parent().attr("breadcrumbs"));var todo=todo_from_bc(details_open_bc);var fleep="";if(todo.tags){$.each(todo.tags,function(key,value){if(fleep!==""){fleep+=", ";}
fleep+=value;});}
html+='<div class=fieldset>';html+='<label>Tags</label>';html+='<input type=text id=details_tags value="'+fleep+'">';html+='</div>';var deets="";if(todo.details){deets=todo.details;}
html+='<div class=fieldset>';html+='<label>Details</label>';html+='<textarea rows=1 id=details_details>'+deets+'</textarea>';html+='</div>';var magic={};if(todo.magic){magic=todo.magic;}
var magic_text=JSON.stringify(magic,null,4);html+='<div class=fieldset>';html+='<label>Magic</label>';html+='<textarea rows=1 id=details_magic>'+magic_text+'</textarea>';html+='</div>';obj.html=html;return obj;}
function details_dialog_save(){var todo=todo_from_bc(details_open_bc);todo.tags={};var tag_input=$('#details_tags').val();if(tag_input!==""){var split=tag_input.split(",");$.each(split,function(key,value){split[key]=$.trim(value);});todo.tags=split;}
var details_input=$('#details_details').val();todo.details=details_input;var magic_input=$('#details_magic').val();var new_json={};try{new_json=jQuery.parseJSON(magic_input);if(magic_input!=="{}"){window.thar_be_magic=true;}}catch(e){alert('Sorry, there was an error parsing your magic json!');return;}
todo.magic=new_json;save_to_bc(details_open_bc,todo);dialog_close();alldone_update_notify();}
function settings_dialog(){dialog({type:'settings'});$('#dialog_update').click(function(){settings_dialog_save();});}
function settings_dialog_gen(){var obj={},html='';html+='<div class=fieldset>';html+='<label>Mode</label>';html+='<select id=\"modeselect\">';html+="<option value=\"horizontal\""+selected_if_true("horizontal",user_options.mode)+">Horizontal</option>";html+="<option value=\"vertical\""+selected_if_true("vertical",user_options.mode)+">Vertical</option>";html+="</select>";html+='</div>';html+='<div class=fieldset>';html+='<label>Scheme</label>';html+='<select id=\"colourscheme\">';html+="<option value=\"slate\""+selected_if_true("slate",user_options.colourscheme)+">Slate</option>";html+="<option value=\"purple\""+selected_if_true("purple",user_options.colourscheme)+">Purple</option>";html+="<option value=\"vertbw\""+selected_if_true("vertbw",user_options.colourscheme)+">B&amp;W vertical</option>";html+="</select>";html+='</div>';html+='<div class=fieldset>';html+='<label>Editing</label>';html+='<select id=\"editing\">';html+="<option value=\"normal\""+selected_if_true(false,user_options.editmode)+">Normal mode</option>";html+="<option value=\"click\""+selected_if_true(true,user_options.editmode)+">Click to edit</option>";html+="</select>";html+='</div>';obj.html=html;return obj;}
function settings_dialog_save(){var check=$('#colourscheme').val();user_options.colourscheme=check;var check=$('#modeselect').val();user_options.mode=check;console.log(check);check=$('#editing').val();if(check=='click'){user_options.editmode=true;}else{user_options.editmode=false;}
redraw(open_breadcrumbs);dialog_close();alldone_update_notify();}
function selected_if_true(a,b){if(a==b){return" selected";}}var magic_update=false;var ajax_multi=0;function magic_scan_init(){magic_update=false;todo_list=magic_scan(todo_list,0);}
function magic_attemptupdate(){ajax_multi--;if(ajax_multi===0){setTimeout(function(){window.thar_be_magic=true;redraw(open_breadcrumbs);dialog_close();},250);}}
function magic_scan(todo_list_mod,step){var first_loop=false;if(step===0){first_loop=true;}
$.each(todo_list_mod,function(key,value){if(value){if((value.magic)){this.children=magic_process(value.magic,this.children);}else{if(value.children){this.children=magic_scan(this.children,(step+1));}}}});return todo_list_mod;}
function magic_process(magic,mod){if((magic.list)&&(magic.list==='github_issues')){mod=magic_github_issues(magic,mod);}
return mod;}
function magic_github_issues(magic,mod){var uri="https://api.github.com/repos/"+magic.username+"/"+magic.repo+"/issues"
var output=[];dialog({type:'magic',subtext:'Github Issues'});ajax_multi++;$.getJSON(uri,"").done(function(json){$.each(json,function(key,value){var newtodo=clone_item(todo_blank);if(mod){$.each(mod,function(key2,value2){if(value2.unique==='git_'+value.id){newtodo=clone_item(value2);}});}
newtodo.title=value.title;newtodo.unique='git_'+value.id;output.push(newtodo);});magic_attemptupdate();}).fail(function(jqxhr,textStatus,error){var err=textStatus+', '+error;dialog({type:'error',title:'Magic issues',text:'Error retrieving github issues from '+uri+' (error: '+err+')'});});magic_update=true;return output;}
function isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n);}
$(window).resize(function(){sizeup();});var todo_list=[],open_breadcrumbs=[],old_breadcrumbs=[],form_history=[],scroll_history=[],form_count=0;var recursive_fetched={},open_edit=false,sort_mode=false,pause_redraw=false,custom_context=true;var user_options={fullscreen:false,colourscheme:'slate',editmode:false,};var vert_indent=40;var session=0,this_user=-1;var first_load=false,thar_be_magic=false,load_from_var=false,public_use=false,read_only=false;var callbacks=[],redrawing=[];var todo_blank={title:'',unique:0,tags:{},details:'',done:false,icon:'',dateSet:0,dateDue:0,dateComplete:0,children:[]};var todo_title="list",todo_owner='';var todo_list=[{title:'Debugging',done:false},{title:'willy',done:false},{title:'Marketing',done:false,children:[{title:'willy',done:false},{title:'poo',done:false,children:[{title:'wank',done:false},{title:'hat',done:false,children:[{title:'wank',done:false},{title:'aaaaaa',done:false},{title:'afff',done:false}]},{title:'afff',done:false}]}]},{title:'Willy',done:false},{title:'Flannageddon',done:false,children:[{title:'assssss',done:false},{title:'moooma',done:false}]}];var todo_list=[{"title":"1","done":false,"subtext":"","tags":["wank","ham","spam"],"icon":"","dateSet":0,"dateDue":0,"dateComplete":0,"children":[{"title":"a","done":false,"subtext":"","icon":"","dateSet":0,"dateDue":0,"dateComplete":0,"children":[]},{"title":"b","done":false,"subtext":"","icon":"","dateSet":0,"dateDue":0,"dateComplete":0,"children":[]},{"title":"c","done":false,"subtext":"","icon":"","dateSet":0,"dateDue":0,"dateComplete":0,"children":[{"title":"arghhh#]","done":false,"subtext":"","icon":"","dateSet":0,"dateDue":0,"dateComplete":0,"children":[]}]}]},{"title":"blah blah rarh hello blh lagh ah asjk ash asjkdh asjkdhas jkasdhasdjka asdhasasd","done":false,"subtext":"","icon":"","dateSet":0,"dateDue":0,"dateComplete":0,"children":[]},{"title":"3","done":false,"subtext":"","icon":"","magic":{"list":"no_github_issues","username":"rails","repo":"rails"},"dateSet":0,"dateDue":0,"dateComplete":0,"children":[]}];function callback(set,what){if(set){callbacks.push(what);}else{if(callbacks.length>0){$.each(callbacks,function(key,value){if(value.method==='focus_new'){setTimeout(function(){$('#'+value.id+' textarea.new').val('');$('#'+value.id+' textarea.new').focus();},1);}});callbacks=[];}}}
function draw_list(crumbs){var drawList=get_breadcrumbs(crumbs),crumbIndex=crumbs.length;var text_bc=textualize_breadcrumbs(crumbs);var ulClass='horizontal',ulStyle='';if(user_options.mode==='vertical'){ulClass='vertical';ulStyle='margin-left: '+(vert_indent*crumbIndex)+'px;';}
var html="<ul class=\"list "+ulClass+"\" style=\""+ulStyle+"\" id=\"crumbs-"+(crumbIndex)+"\" breadcrumbs=\""+text_bc+"\">";if(crumbIndex===0){html+="<li class=\"static list_header\">";if(runtime=='app'){html+="<div class=\"mainmenu app\" title=\"load lists or log out\"><i class=\"fa fa-bars\"></i></div>";}
if(runtime=='web'){html+="<div class=\"mainmenu web\" title=\"back to alldone.io\"><i class=\"fa fa fa-arrow-left\"></i></div>";}
html+="/"+todo_owner+"/"+todo_title;if(!read_only){html+="<div class=\"settings\" title=\"colour and settings\"><i class=\"fa fa-cog\"></i></div>";}
html+="<div class=\"controls\">";if(thar_be_magic){html+="<div class=\"magic_refresh\" title=\"refresh magic\"><i class=\"fa fa-magic\"></i></div>";}
html+="<div class=\"json_view\" title=\"modify json\"><i class=\"fa fa-file-code-o\"></i></div>";if(!read_only){html+="<div class=\"sort_toggle";if(sort_mode){html+=" on";}
html+="\" title=\"reorder\"><i class=\"fa fa-sort\"></i></div>";}
html+="</div></li>";}else{var parent_todo=fetch_todo(crumbs);html+="<li class=\"static list_header close_header\"><i class=\"fa fa-arrow-left\"></i> "+parent_todo.title+"</li>";}
for(i=0;i<drawList.length;i++){var item=drawList[i];html+=draw_list_item(item,crumbIndex,i,text_bc,crumbs);if(user_options.mode=='vertical'){if(isNumber(redrawing[crumbIndex])){if((redrawing[crumbIndex]===i)){html+=draw_list_vertical_sub(item,i,crumbIndex,text_bc,crumbs);}}}}
if(!read_only){html+=draw_list_input(crumbIndex,text_bc);}
html+="</ul>";return html;}
function draw_list_item(item,crumbIndex,itemIndex,text_bc,crumbs){var html="<li id=\"item-"+crumbIndex+"-"+itemIndex+"\" breadcrumbs=\""+text_bc+"-"+itemIndex+"\">";if(item.editing){html+="<div class=\"more editing_force\"><i class=\"fa fa-cog fa-fw\"></i></div>";html+='<textarea class=\"edit\" type=\"text\" id=\"new-"+crumbIndex+"\" rows=1>'+item.title+'</textarea>';}else{html+="<div class=\"checkbox\">"+checkbox_please(item.done)+"</div>";html+="<label>"+item.title;if((item.tags)&&(item.tags.length>0)){$.each(item.tags,function(i,val){html+="<div class=\"tag\">"+val+"</div>";});}
html+="</label>";}
if(item.children){var expandCss='expand',arrowDir='right';if(isNumber(redrawing[crumbIndex])){if(redrawing[crumbIndex]===i){expandCss='contract';arrowDir='right';}}
if(item.editing){expandCss+=' editing_force';}
var countDisplay=count_my_children(item.children);if((item.children.length>0)||(user_options.editmode)){html+="<div class=\"count\">"+style_count_my_children(countDisplay)+"</div>";}}
if((!user_options.editmode)&&(!read_only)){html+="<div class=edit_button><i class=\"fa fa-pencil fa-fw\"></i></div>";}
html+="</li>";return html;}
function draw_list_input(crumbIndex,text_bc){var html="<li class=\"static\">";html+="<div class=\"checkbox disabled\">"+checkbox_please(false)+"</div> <textarea class=\"new\" type=\"text\" id=\"new-"+crumbIndex+"\" breadcrumbs=\""+text_bc+"\" rows=1></textarea>";html+="</li>";return html;}
function draw_list_vertical_sub(item,thisIndex,crumbIndex,text_bc,crumbs){var crumbIndexIncrem=crumbIndex+1,text_bcIncrem=text_bc+'-'+thisIndex,countIndex=0;var html="<li id=\"vert-crumbs-"+(crumbIndexIncrem)+"\">";html+="<ul class=\"list vertical\" style=\"margin-left: "+(vert_indent)+"px;\" id=\"crumbs-"+(crumbIndexIncrem)+"\" breadcrumbs=\""+text_bc+"\">";$.each(item.children,function(key,value){html+=draw_list_item(this,crumbIndexIncrem,countIndex,text_bcIncrem,crumbs);if(isNumber(redrawing[crumbIndexIncrem])){if(redrawing[crumbIndexIncrem]===countIndex){html+=draw_list_vertical_sub(this,countIndex,crumbIndexIncrem,text_bcIncrem,crumbs);}}
countIndex++;});if(!read_only){html+=draw_list_input(crumbIndexIncrem,text_bcIncrem);}
html+="</ul></li>";return html;}
function get_breadcrumbs(crumbs){var now=todo_list;$.each(crumbs,function(i,val){if(now[val]){if(now[val].children){now=now[val].children;}}else{console.log('ERROR could not read '+val+' of:');console.log(now);}});return now;}
function textualize_breadcrumbs(crumbs){var txt='x';$.each(crumbs,function(i,val){txt+='-'+val;});return txt;}
function count_my_children(items){var cDone=0,cNotDone=0;$.each(items,function(i,val){if(val.done){cDone++;}else{cNotDone++;}});return cNotDone;}
function style_count_my_children(count){if(count===0){return"<i class=\"fa fa-check\"></i>";}else{return count;}}
function expand(e){var bc=breadcrumb_explosion($(e).attr("breadcrumbs"));redraw(bc);}
function close(e){var bc=breadcrumb_explosion($(e).attr("breadcrumbs"));bc.splice(-1,1);redraw(bc);}
function check(e,event,bc_hack){var bc=breadcrumb_explosion($(e).parent().attr("breadcrumbs"));var this_todo=todo_from_bc(bc);if(this_todo){if(this_todo.done){this_todo.done=false;}else{this_todo.done=true;}
pause_redraw=true;save_to_bc(bc,this_todo);pause_redraw=false;$('#'+$(e).parent().attr("id")+' div.checkbox').html(checkbox_please(this_todo.done));if(event.shiftKey){recurse_todo(bc,{done_set:true,done:this_todo.done});}
alldone_update_notify();update_count(bc);}}
function add(e){if(e){var title=$(e).val();if($.trim(title)!==""){var id=$(e).attr("id");var bc=$(e).attr("breadcrumbs");var parent_ul=$(e).closest("ul").attr("id");callback(true,{method:'focus_new',id:parent_ul});var id_split=id.split("-");var bc_location=id_split[1];var new_todo=todo_blank;new_todo.title=title;add_todo(new_todo,breadcrumb_explosion(bc));alldone_update_notify();}}}
function modify(e){if((e)&&(!sort_mode)){if(open_edit){modify_save_open();}
var id=$(e).parent().attr("id");var id_split=id.split("-");var bc_location=id_split[1];var bc_index=id_split[2];var bc=breadcrumb_explosion($(e).parent().attr("breadcrumbs"));open_edit=e;modify_todo({editing:true,editingUpdate:true},bc);$('body').click(function(event){var saveChanges=false;if(!$(event.target).closest('#'+id).length){modify_save_open();}});$('.editing_force').click(function(){modify_save_open();});$('#'+id+' textarea.edit').focus();$('#'+id+' textarea.edit').select();}}
function modify_save_open(){if(open_edit){var id=$(open_edit).parent().attr("id");var id_split=id.split("-");var bc_location=id_split[1];var bc_index=id_split[2];var bc=breadcrumb_explosion($(open_edit).parent().attr("breadcrumbs"));var newTitle=$('#'+id+' textarea.edit').val();var modifications=todo_from_bc(bc);if($.trim(newTitle)!==""){modifications.title=newTitle;pause_redraw=true;modify_todo({editing:false,editingUpdate:true},bc);pause_redraw=false;modify_todo(modifications,bc);alldone_update_notify();}else{if((modifications.children)&&(modifications.children.length>0)){$('#'+id+' textarea.edit').val('');dialog({type:'delete_with_children'});$('#dialog_delete').click(function(){var bc_parent=breadcrumb_removelast(bc);var bc_del_target=breadcrumb_returnlast(bc);todo_list=recursive_magic(bc_parent,0,'delete',{target:bc_del_target},todo_list);todo_list=recursive_tidy(todo_list);redraw(open_breadcrumbs);dialog_close();alldone_update_notify();});$('#dialog_cancel, #overlay').click(function(){modify_todo({editing:false,editingUpdate:true},bc);open_edit=false;dialog_close();});}else{var bc_parent=breadcrumb_removelast(bc);var bc_del_target=breadcrumb_returnlast(bc);todo_list=recursive_magic(bc_parent,0,'delete',{target:bc_del_target},todo_list);todo_list=recursive_tidy(todo_list);redraw(open_breadcrumbs);alldone_update_notify();}}
$('body').unbind("click");$('.editing_force').unbind("click");open_edit=false;}}
function update_count(bc){bc=breadcrumb_removelast(bc);if(bc.length>0){var todo=todo_from_bc(bc);if(todo.children){var newCount=count_my_children(todo.children);var aim='#item-'+(bc.length-1)+'-'+bc[bc.length-1];$(aim+' div.count').show();$(aim+' div.count').html(style_count_my_children(newCount));if(todo.children.length>0){if(newCount==0){if(!todo.done){$(aim+' div.checkbox').trigger('click');}}else{if(todo.done){$(aim+' div.checkbox').trigger('click');}}}}}}
function json_mod_start(){$('#overlay').show();$('#json_jazz').show();var json_string=JSON.stringify(todo_list,null,4);$('#json_jazz > textarea').val(json_string);}
function json_mod_save(){var new_json;try{new_json=jQuery.parseJSON($('#json_jazz > textarea').val());todo_list=new_json;redraw([]);json_mod_cancel();alldone_update_notify();}catch(e){console.log(e);alert('Error parsing the JSON\r\n"'+e.message+'"\r\n(Error also visible in console).');return;}}
function json_mod_cancel(){$('#overlay').hide();$('#json_jazz').hide();}
var stress_test_total=0;function stress_test(){var r=confirm("Stress Test.\n\rThis will create nearly 20,000 items and also overwrite your current to do list. Proceed?");if(r==true){var n=[];var steps=0;console.log('STARTING');n=stress_test_sub(n,0);todo_list=n;redraw([]);console.log('Done. Made '+stress_test_total+' items... sorry.');}}
function stress_test_sub(n,steps){var i=0;for(i=0;i<7;i++){if(steps===0){console.log(i+'/6');}
var n_td=clone_item(todo_blank);n_td.title=Math.floor((Math.random()*10000)+1);n_td.title=n_td.title.toString();n[i]=n_td;stress_test_total++;if(steps<4){n[i].children=stress_test_sub(n[i].children,(steps+1));}}
return n;}runtime='web';$(window).load(function(){if((load_from_var)&&(load_item)){public_use=false
read_only=false;login.session=get_cookie();login.uid=load_uid;if((load_permission==8)||(load_permission==9)||(load_permission==1)){public_use=true;}
if((load_permission==8)||(load_permission==1)){read_only=true;}
if((!login.session)&&(!public_use)){dialog({type:'error',title:'Error',text:'Session not present. Please retry.'});return 0;}
todo_list=load_item.todo_list;todo_title=load_title;todo_owner=load_owner;user_options.colourscheme=load_item.colourscheme;user_options.mode=load_item.mode;first_load=true;redraw([]);}else{dialog({type:'error',title:'Error',text:'Data not present. Please retry.'});}});function get_cookie(){var coo=document.cookie.split(';'),r=0;$.each(coo,function(key,value){var trimmed=$.trim(value);var t=trimmed.split('=');if(t[0]==='alldone'){var s=decodeURIComponent(t[1]);r=s.split('^');r=r[1];}});return r;}